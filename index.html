<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Klondike Solitaire</title>
<style>
  :root {
    --bg: #0b1d26;
    --felt: #0e3d2a;
    --card: #ffffff;
    --card-back: #1c6f5a;
    --accent: #d6b25e;
    --muted: #b5c3c7;
  }
  * { box-sizing: border-box; user-select: none; }
  html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
  body { background: radial-gradient(1200px 800px at 50% 10%, var(--felt) 0%, #062116 60%, #03140e 100%); color: #ecf5f1; display: flex; flex-direction: column; }

  header { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,0)); position: sticky; top: 0; backdrop-filter: blur(6px); z-index: 5; }
  header h1 { font-size: 18px; font-weight: 600; margin: 0 12px 0 0; }
  button, select { background: #143e30; color: #e7fff6; border: 1px solid #266a55; border-radius: 8px; padding: 8px 12px; cursor: pointer; font-weight: 600; }
  .badge { padding: 6px 10px; border-radius: 999px; background: #143e30; border: 1px solid #266a55; font-size: 12px; color: var(--muted); }
  .spacer { flex: 1; }

  #board { flex: 1; padding: 16px; display: grid; grid-template-rows: auto 1fr; gap: 16px; }
  .row { display: grid; grid-template-columns: repeat(7, 1fr); gap: 16px; min-height: 160px; }

  .pile { position: relative; min-height: 160px; border-radius: 10px; padding: 6px; border: 2px dashed rgba(255,255,255,.12); background: rgba(0,0,0,.1); }

  .card { position: absolute; width: 96px; height: 140px; border-radius: 10px; box-shadow: 0 8px 18px rgba(0,0,0,.35); border: 1px solid rgba(0,0,0,.35); background: var(--card); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 20px; }
  .card.face-down { background: repeating-linear-gradient(45deg, var(--card-back), var(--card-back) 8px, #115645 8px, #115645 16px); color: transparent; }
  .card .tiny { position: absolute; top: 6px; left: 8px; font-weight: 800; font-size: 14px; }
  .card .suit { font-size: 24px; }
  .red { color: #c0392b; }
  .black { color: #2c3e50; }

  .pile.foundation::after { content: "\2660\2665\2666\2663"; position: absolute; inset: 0; display: grid; place-items: center; opacity: .08; font-size: 28px; letter-spacing: 8px; }

  .selected { outline: 4px solid var(--accent); z-index: 4; }
</style>
</head>
<body>
<header>
  <h1>Klondike</h1>
  <button id="newGame">New game</button>
  <button id="undoBtn">Undo</button>
  <label class="badge">Draw
    <select id="drawMode">
      <option value="1">1</option>
      <option value="3" selected>3</option>
    </select>
  </label>
  <button id="autoBtn">Auto-move</button>
  <div class="spacer"></div>
  <span class="badge" id="status">Moves: 0 • Time: 0:00</span>
</header>

<main id="board">
  <div class="row" id="topRow">
    <div class="pile stock" id="stock"></div>
    <div class="pile waste" id="waste"></div>
    <div class="spacer"></div>
    <div class="pile foundation" id="foundation-0"></div>
    <div class="pile foundation" id="foundation-1"></div>
    <div class="pile foundation" id="foundation-2"></div>
    <div class="pile foundation" id="foundation-3"></div>
  </div>
  <div class="row" id="bottomRow">
    <div class="pile tableau" id="tableau-0"></div>
    <div class="pile tableau" id="tableau-1"></div>
    <div class="pile tableau" id="tableau-2"></div>
    <div class="pile tableau" id="tableau-3"></div>
    <div class="pile tableau" id="tableau-4"></div>
    <div class="pile tableau" id="tableau-5"></div>
    <div class="pile tableau" id="tableau-6"></div>
  </div>
</main>

<script>
const SUITS = ["♠", "♥", "♦", "♣"];
const COLORS = ["black", "red", "red", "black"];
const RANKS = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
let piles, stock, waste, foundations, tableaus, moves = 0, startTime = 0, timerId, drawCount = 3, selected = null;

function newDeck(){
  const d=[];
  for(let s=0;s<4;s++){ for(let r=1;r<=13;r++) d.push({s,r,up:false,id:crypto.randomUUID()}); }
  for(let i=d.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [d[i],d[j]]=[d[j],d[i]]; }
  return d;
}

function deal(){
  const deck=newDeck();
  piles={stock:[],waste:[],foundations:[[],[],[],[]],tableaus:[[],[],[],[],[],[],[]]};
  for(let t=0;t<7;t++){
    for(let k=0;k<=t;k++){
      const c=deck.pop();
      c.up=(k===t);
      piles.tableaus[t].push(c);
    }
  }
  piles.stock=deck;
  stock=document.getElementById('stock');
  waste=document.getElementById('waste');
  foundations=[0,1,2,3].map(i=>document.getElementById(`foundation-${i}`));
  tableaus=[0,1,2,3,4,5,6].map(i=>document.getElementById(`tableau-${i}`));
  moves=0; startTime=Date.now();
  if(timerId)clearInterval(timerId);
  timerId=setInterval(updateStatus,1000);
  render();
}

function elapsed(){return Math.floor((Date.now()-startTime)/1000);}
function updateStatus(){const t=elapsed();const m=Math.floor(t/60),s=String(t%60).padStart(2,'0');document.getElementById('status').textContent=`Moves: ${moves} • Time: ${m}:${s}`;}
function clearChildren(e){while(e.firstChild)e.removeChild(e.firstChild);}
function render(){
  drawCount=parseInt(document.getElementById('drawMode').value,10);
  clearChildren(stock); clearChildren(waste);
  piles.stock.forEach((c,i)=>{stock.appendChild(makeCard(c,i*0.15,0));});
  piles.waste.forEach((c,i)=>{waste.appendChild(makeCard(c,i*18,0));});
  for(let f=0;f<4;f++){clearChildren(foundations[f]);piles.foundations[f].forEach((c,i)=>{foundations[f].appendChild(makeCard(c,i*0.5,0));});}
  for(let t=0;t<7;t++){clearChildren(tableaus[t]);piles.tableaus[t].forEach((c,i)=>{tableaus[t].appendChild(makeCard(c,0,i*28));});}
}

function makeCard(card,x,y){
  const el=document.createElement('div');
  el.className=`card ${card.up?'':'face-down'} ${COLORS[card.s]}`;
  el.style.left=`${x}px`; el.style.top=`${y}px`;
  el.dataset.id=card.id;
  if(card.up){
    const tiny=document.createElement('div');tiny.className='tiny';tiny.textContent=`${RANKS[card.r-1]}${SUITS[card.s]}`;el.appendChild(tiny);
    const suit=document.createElement('div');suit.className='suit';suit.textContent=`${SUITS[card.s]}`;el.appendChild(suit);
  }
  el.onclick=()=>onCardClick(card.id);
  return el;
}

function findCard(id){
  for(let i=0;i<piles.stock.length;i++) if(piles.stock[i].id===id) return {w:'stock',i};
  for(let i=0;i<piles.waste.length;i++) if(piles.waste[i].id===id) return {w:'waste',i};
  for(let f=0;f<4;f++){for(let i=0;i<piles.foundations[f].length;i++) if(piles.foundations[f][i].id===id) return {w:'foundation',i:f,pos:i};}
  for(let t=0;t<7;t++){for(let i=0;i<piles.tableaus[t].length;i++) if(piles.tableaus[t][i].id===id) return {w:'tableau',i:t,pos:i};}
  return null;
}

function onCardClick(id){
  const loc=findCard(id);
  if(!loc) return;
  if(loc.w==='stock') return;
  if(loc.w==='tableau'){
    const stack=piles.tableaus[loc.i];
    const card=stack[loc.pos];
    if(!card.up){
      if(loc.pos===stack.length-1){card.up=true;moves++;render();}
      return;
    }
    selected={cards:stack.slice(loc.pos),from:loc};
  } else if(loc.w==='waste'){
    selected={cards:[piles.waste[loc.i]],from:loc};
  }
}

function moveToTableau(cards,targetIndex){
  const target=piles.tableaus[targetIndex];
  if(target.length===0 && cards[0].r!==13) return false;
  if(target.length>0){
    const top=target[target.length-1];
    if(COLORS[cards[0].s]===COLORS[top.s] || cards[0].r!==top.r-1) return false;
  }
  removeFromSource(cards.length);
  target.push(...cards);
  moves++;
  render();
  return true;
}

function removeFromSource(count){
  const from=selected.from;
  if(from.w==='waste') piles.waste.splice(from.i,count);
  else if(from.w==='tableau') piles.tableaus[from.i].splice(from.pos,count);
}

document.getElementById('stock').onclick=()=>{
  if(piles.stock.length===0){while(piles.waste.length){const c=piles.waste.pop();c.up=false;piles.stock.push(c);}render();return;}
  for(let i=0;i<drawCount && piles.stock.length;i++){const c=piles.stock.pop();c.up=true;piles.waste.push(c);}
  moves++;render();
};

for(let ti=0;ti<7;ti++){
  tableaus[ti]?.addEventListener('click',()=>{
    if(selected) moveToTableau(selected.cards,ti);
  });
}

document.getElementById('newGame').onclick=deal;
deal();
</script>
</body>
</html>
