<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Klondike Solitaire</title>
<style>
  :root {
    --bg: #0b1d26;
    --felt: #0e3d2a;
    --card: #ffffff;
    --card-back: #1c6f5a;
    --accent: #d6b25e;
    --muted: #b5c3c7;
  }
  * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
  html, body { height: 100%; margin: 0; font-family: system-ui, sans-serif; }
  body { background: radial-gradient(1200px 800px at 50% 10%, var(--felt) 0%, #062116 60%, #03140e 100%); color: #ecf5f1; display: flex; flex-direction: column; }

  header { display: flex; flex-wrap: wrap; align-items: center; gap: 8px; padding: 8px 12px; background: rgba(0,0,0,.35); backdrop-filter: blur(6px); }
  header h1 { font-size: 18px; margin: 0; }
  button, select { background: #143e30; color: #e7fff6; border: 1px solid #266a55; border-radius: 8px; padding: 8px 12px; cursor: pointer; font-weight: 600; font-size: 14px; }
  .badge { padding: 6px 10px; border-radius: 999px; background: #143e30; border: 1px solid #266a55; font-size: 12px; color: var(--muted); }
  .spacer { flex: 1; }

  #board { flex: 1; padding: 8px; display: grid; grid-template-rows: auto 1fr; gap: 12px; }
  .row { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; min-height: 120px; }

  .pile { position: relative; min-height: 120px; border-radius: 8px; padding: 4px; border: 2px dashed rgba(255,255,255,.12); background: rgba(0,0,0,.1); }
  .card { position: absolute; width: 80px; height: 116px; border-radius: 8px; box-shadow: 0 6px 14px rgba(0,0,0,.35); border: 1px solid rgba(0,0,0,.35); background: var(--card); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 18px; }
  .card.face-down { background: repeating-linear-gradient(45deg, var(--card-back), var(--card-back) 8px, #115645 8px, #115645 16px); color: transparent; }
  .card .tiny { position: absolute; top: 4px; left: 6px; font-size: 12px; }
  .card .suit { font-size: 20px; }
  .red { color: #c0392b; }
  .black { color: #2c3e50; }
  .selected { outline: 4px solid var(--accent); z-index: 4; }

  @media (max-width: 600px) {
    .card { width: 60px; height: 88px; font-size: 14px; }
    .card .tiny { font-size: 10px; }
    .card .suit { font-size: 16px; }
    .pile { min-height: 100px; }
  }
</style>
</head>
<body>
<header>
  <h1>Klondike</h1>
  <button id="newGame">New</button>
  <label class="badge">Draw
    <select id="drawMode">
      <option value="1">1</option>
      <option value="3" selected>3</option>
    </select>
  </label>
  <div class="spacer"></div>
  <span class="badge" id="status">Moves: 0</span>
</header>

<main id="board">
  <div class="row">
    <div class="pile" id="stock"></div>
    <div class="pile" id="waste"></div>
    <div class="spacer"></div>
    <div class="pile foundation" id="foundation-0"></div>
    <div class="pile foundation" id="foundation-1"></div>
    <div class="pile foundation" id="foundation-2"></div>
    <div class="pile foundation" id="foundation-3"></div>
  </div>
  <div class="row">
    <div class="pile tableau" id="tableau-0"></div>
    <div class="pile tableau" id="tableau-1"></div>
    <div class="pile tableau" id="tableau-2"></div>
    <div class="pile tableau" id="tableau-3"></div>
    <div class="pile tableau" id="tableau-4"></div>
    <div class="pile tableau" id="tableau-5"></div>
    <div class="pile tableau" id="tableau-6"></div>
  </div>
</main>

<script>
const suits = ["♠","♥","♦","♣"];
const ranks = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
let stock = [], waste = [], foundations = [[],[],[],[]], tableaus = [[],[],[],[],[],[],[]];
let drawCount = 3;
let selectedCard = null, selectedSource = null;
let moves = 0;

document.getElementById("drawMode").addEventListener("change", e => {
  drawCount = parseInt(e.target.value);
});

document.getElementById("newGame").addEventListener("click", newGame);

function newGame(){
  stock = [], waste = [], foundations = [[],[],[],[]], tableaus = [[],[],[],[],[],[],[]];
  moves = 0;
  let deck = [];
  suits.forEach(s => ranks.forEach(r => deck.push({rank:r, suit:s, faceUp:false})));
  deck.sort(() => Math.random() - 0.5);
  for(let i=0;i<7;i++){
    for(let j=0;j<=i;j++){
      let card = deck.pop();
      card.faceUp = j === i;
      tableaus[i].push(card);
    }
  }
  stock = deck;
  render();
}

function render(){
  document.getElementById("status").textContent = `Moves: ${moves}`;
  const stockEl = document.getElementById("stock");
  stockEl.innerHTML = "";
  if(stock.length){
    const back = createCardEl({faceUp:false});
    back.addEventListener("click", drawFromStock);
    stockEl.appendChild(back);
  } else {
    stockEl.addEventListener("click", resetStock);
  }

  const wasteEl = document.getElementById("waste");
  wasteEl.innerHTML = "";
  waste.slice(-drawCount).forEach((card,i) => {
    const el = createCardEl(card);
    el.style.left = `${i*15}px`;
    el.addEventListener("click", () => selectCard(card, "waste"));
    wasteEl.appendChild(el);
  });

  foundations.forEach((pile,fi) => {
    const el = document.getElementById(`foundation-${fi}`);
    el.innerHTML = "";
    if(pile.length){
      const top = pile[pile.length-1];
      el.appendChild(createCardEl(top));
    }
    el.addEventListener("click", () => moveSelectedTo("foundation", fi));
  });

  tableaus.forEach((pile,ti) => {
    const el = document.getElementById(`tableau-${ti}`);
    el.innerHTML = "";
    pile.forEach((card,ci) => {
      const cardEl = createCardEl(card);
      cardEl.style.top = `${ci*25}px`;
      if(card.faceUp){
        cardEl.addEventListener("click", () => selectCard(card, "tableau", ti, ci));
      }
      el.appendChild(cardEl);
    });
    el.addEventListener("click", () => moveSelectedTo("tableau", ti));
  });
}

function createCardEl(card){
  const el = document.createElement("div");
  el.className = "card" + (card.faceUp ? "" : " face-down") + (["♥","♦"].includes(card.suit) ? " red" : " black");
  if(card.faceUp){
    const tiny = document.createElement("div");
    tiny.className = "tiny";
    tiny.textContent = card.rank + card.suit;
    const suitEl = document.createElement("div");
    suitEl.className = "suit";
    suitEl.textContent = card.suit;
    el.appendChild(tiny);
    el.appendChild(suitEl);
  }
  return el;
}

function drawFromStock(){
  if(!stock.length) return;
  for(let i=0;i<drawCount && stock.length;i++){
    const card = stock.pop();
    card.faceUp = true;
    waste.push(card);
  }
  moves++;
  render();
}

function resetStock(){
  stock = waste.reverse().map(c => ({...c, faceUp:false}));
  waste = [];
  moves++;
  render();
}

function selectCard(card, source, ti=null, ci=null){
  selectedCard = {card, ti, ci};
  selectedSource = source;
}

function moveSelectedTo(dest, index){
  if(!selectedCard) return;
  const {card, ti, ci} = selectedCard;
  if(dest === "foundation"){
    const pile = foundations[index];
    if(canMoveToFoundation(card, pile)){
      removeCardFromSource();
      pile.push(card);
      moves++;
    }
  }
  if(dest === "tableau"){
    const pile = tableaus[index];
    if(canMoveToTableau(card, pile)){
      removeCardFromSource();
      if(selectedSource === "tableau"){
        pile.push(...tableaus[ti].splice(ci));
      } else {
        pile.push(card);
      }
      moves++;
    }
  }
  selectedCard = null; selectedSource = null;
  render();
}

function removeCardFromSource(){
  if(selectedSource === "waste"){
    waste.pop();
  } else if(selectedSource === "tableau"){
    const {ti, ci} = selectedCard;
    tableaus[ti].splice(ci, 1);
    if(tableaus[ti].length && !tableaus[ti][tableaus[ti].length-1].faceUp){
      tableaus[ti][tableaus[ti].length-1].faceUp = true;
    }
  }
}

function canMoveToFoundation(card, pile){
  if(!pile.length) return card.rank === "A";
  const top = pile[pile.length-1];
  return card.suit === top.suit && ranks.indexOf(card.rank) === ranks.indexOf(top.rank)+1;
}

function canMoveToTableau(card, pile){
  if(!pile.length) return card.rank === "K";
  const top = pile[pile.length-1];
  return card.faceUp && cardColor(card) !== cardColor(top) && ranks.indexOf(card.rank) === ranks.indexOf(top.rank)-1;
}

function cardColor(card){
  return ["♥","♦"].includes(card.suit) ? "red" : "black";
}

newGame();
</script>
</body>
</html>
